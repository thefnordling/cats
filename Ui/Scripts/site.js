"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("bootstrap");
require("../scss/_bootstrap-custom.scss");
var ag_grid_community_1 = require("ag-grid-community");
require("ag-grid-community/dist/styles/ag-grid.css");
require("ag-grid-community/dist/styles/ag-theme-balham.css");
var signalR = require("@aspnet/signalr");
var client_1 = require("./nswag/client");
var moment = require("moment");
var Site = /** @class */ (function () {
    function Site() {
        var _this = this;
        this.gridOptions = {};
        this.hubConnection = new signalR.HubConnectionBuilder()
            .withUrl("/HoldingsGrid/hub")
            .build();
        this.catsClient = new client_1.CatsClient();
        this.$catModal = $('#cat-modal');
        this.$catTitle = $('#cat-modal-title');
        this.$confirmSave = $('#confirm-save');
        this.$deleteModal = $('#delete-modal');
        this.$deleteCatName = $('#delete-modal-cat-name');
        this.$confirmDelete = $('#confirm-delete');
        this.$catId = $('#cat-id');
        this.$catName = $('#cat-name');
        this.$catBirth = $('#cat-birth');
        this.$catMood = $('#cat-mood');
        this.$catHungry = $('#cat-hungry');
        this.gridOptions.columnDefs = this.getColumns();
        this.gridOptions.getRowNodeId = function (cat) { return cat.id || ""; };
        this.gridOptions.rowSelection = 'single';
        this.gridOptions.enableSorting = true;
        this.gridOptions.enableCellChangeFlash = true;
        this.gridOptions.enableColResize = true;
        this.gridOptions.rowData = [];
        this.gridOptions.onSelectionChanged = function (event) { return _this.gridSelectionChanged(event); };
        var eGridDiv = document.querySelector('#cat-grid');
        new ag_grid_community_1.Grid(eGridDiv, this.gridOptions);
        this.catsClient.get(function (cats) { return _this.loadCats(cats); });
        $('.modal-action').click(function (e) {
            var $target = $(e.target);
            if ($target.data('action') && $target.data('target')) {
                $($target.data('target')).data('action', $target.data('action'));
            }
        });
        this.$catModal.on('show.bs.modal', function () { return _this.catModalShown(); });
        this.$deleteModal.on('show.bs.modal', function () { return _this.deleteModalShown(); });
    }
    Site.prototype.gridSelectionChanged = function (event) {
        var selected = this.getSelectedCat();
        if (selected) {
            $('.selection-required').prop('disabled', false);
        }
        else {
            $('.selection-required').prop('disabled', true);
        }
    };
    Site.prototype.catModalShown = function () {
        var selected = this.getSelectedCat() || new client_1.Cat();
        this.setModalFromCat(selected);
        this.$catTitle.text("Add A Cat");
    };
    Site.prototype.deleteModalShown = function () {
    };
    Site.prototype.loadCats = function (cats) {
        this.gridOptions.api.setRowData(cats || []);
    };
    Site.prototype.getColumns = function () {
        return [
            { headerName: "Id", field: "id" },
            { headerName: "Name", field: "name" },
            { headerName: "Birth", field: "birth" },
            { headerName: "Hungry", field: "hungry" },
            { headerName: "Mood", field: "mood" }
        ];
    };
    Site.prototype.getSelectedCat = function () {
        var selected = this.gridOptions.api.getSelectedNodes();
        if (selected && selected.length) {
            return selected[0].data;
        }
        return undefined;
    };
    Site.prototype.getCatFromModal = function () {
        return new client_1.Cat({
            id: this.getInputString(this.$catId),
            name: this.getInputString(this.$catName),
            birth: this.getInputDate(this.$catBirth),
            hungry: this.getInputBoolean(this.$catHungry),
            mood: this.getInputMood(this.$catMood)
        });
    };
    Site.prototype.setModalFromCat = function (cat) {
        this.$catId.val(cat.id || "");
        this.$catName.val(cat.name || "");
        this.$catBirth.val(moment(cat.birth).format());
        this.$catHungry.prop('checked', cat.hungry);
        this.$catModal.val(cat.mood);
    };
    Site.prototype.getInputString = function ($input) {
        var val = $input.val();
        if (val !== 0 && !val) {
            return undefined;
        }
        return String(val);
    };
    Site.prototype.getInputDate = function ($input) {
        var m = moment($input.val());
        if (!m.isValid()) {
            return moment().toDate();
        }
        else {
            return m.toDate();
        }
    };
    Site.prototype.getInputBoolean = function ($input) {
        return $input.is(':checked') || false;
    };
    Site.prototype.getInputMood = function ($input) {
        var val = $input.val();
        if (val == client_1.Mood.Amber) {
            return client_1.Mood.Amber;
        }
        else if (val == client_1.Mood.Green) {
            return client_1.Mood.Green;
        }
        else if (val == client_1.Mood.Red) {
            return client_1.Mood.Red;
        }
        else {
            return client_1.Mood.None;
        }
    };
    return Site;
}());
new Site();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2l0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNpdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxxQkFBbUI7QUFDbkIsMENBQXdDO0FBQ3hDLHVEQUF5STtBQUN6SSxxREFBbUQ7QUFDbkQsNkRBQTJEO0FBQzNELHlDQUEyQztBQUMzQyx5Q0FBdUQ7QUFFdkQsK0JBQWtDO0FBRWxDO0lBb0JJO1FBQUEsaUJBdUJDO1FBMUNTLGdCQUFXLEdBQWdCLEVBQUUsQ0FBQztRQUM5QixrQkFBYSxHQUFHLElBQUksT0FBTyxDQUFDLG9CQUFvQixFQUFFO2FBQ3ZELE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQzthQUM1QixLQUFLLEVBQUUsQ0FBQztRQUNiLGVBQVUsR0FBRyxJQUFJLG1CQUFVLEVBQUUsQ0FBQztRQUM5QixjQUFTLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzVCLGNBQVMsR0FBRyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNsQyxpQkFBWSxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUVsQyxpQkFBWSxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNsQyxtQkFBYyxHQUFHLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQzdDLG1CQUFjLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFdEMsV0FBTSxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0QixhQUFRLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFCLGNBQVMsR0FBRyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDNUIsYUFBUSxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMxQixlQUFVLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRzFCLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztR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TUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLElBQUksR0FBRyxJQUFJLGFBQUksQ0FBQyxLQUFLLEVBQUU7WUFDbkIsT0FBTyxhQUFJLENBQUMsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxHQUFHLElBQUksYUFBSSxDQUFDLEtBQUssRUFBRTtZQUMxQixPQUFPLGFBQUksQ0FBQyxLQUFLLENBQUM7U0FDckI7YUFBTSxJQUFJLEdBQUcsSUFBSSxhQUFJLENBQUMsR0FBRyxFQUFFO1lBQ3hCLE9BQU8sYUFBSSxDQUFDLEdBQUcsQ0FBQztTQUNuQjthQUFNO1lBQ0gsT0FBTyxhQUFJLENBQUMsSUFBSSxDQUFDO1NBQ3BCO0lBQ0wsQ0FBQztJQUNMLFdBQUM7QUFBRCxDQUFDLEFBN0hELElBNkhDO0FBRUQsSUFBSSxJQUFJLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnYm9vdHN0cmFwJztcclxuaW1wb3J0IFwiLi4vc2Nzcy9fYm9vdHN0cmFwLWN1c3RvbS5zY3NzXCI7XHJcbmltcG9ydCB7IEdyaWQsIEdyaWRPcHRpb25zLCBSb3dOb2RlLCBSb3dWYWx1ZUNoYW5nZWRFdmVudCwgUm93RGF0YVVwZGF0ZWRFdmVudCwgQ29sRGVmLCBTZWxlY3Rpb25DaGFuZ2VkRXZlbnQgfSBmcm9tIFwiYWctZ3JpZC1jb21tdW5pdHlcIjtcclxuaW1wb3J0IFwiYWctZ3JpZC1jb21tdW5pdHkvZGlzdC9zdHlsZXMvYWctZ3JpZC5jc3NcIjtcclxuaW1wb3J0IFwiYWctZ3JpZC1jb21tdW5pdHkvZGlzdC9zdHlsZXMvYWctdGhlbWUtYmFsaGFtLmNzc1wiO1xyXG5pbXBvcnQgKiBhcyBzaWduYWxSIGZyb20gXCJAYXNwbmV0L3NpZ25hbHJcIjtcclxuaW1wb3J0IHsgQ2F0c0NsaWVudCwgQ2F0LCBNb29kIH0gZnJvbSBcIi4vbnN3YWcvY2xpZW50XCI7XHJcbmltcG9ydCB7IE1vbWVudCB9IGZyb20gXCJtb21lbnRcIjtcclxuaW1wb3J0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xyXG5cclxuY2xhc3MgU2l0ZSB7XHJcbiAgICBwcm90ZWN0ZWQgZ3JpZE9wdGlvbnMgPSA8R3JpZE9wdGlvbnM+e307XHJcbiAgICBwcm90ZWN0ZWQgaHViQ29ubmVjdGlvbiA9IG5ldyBzaWduYWxSLkh1YkNvbm5lY3Rpb25CdWlsZGVyKClcclxuICAgICAgICAud2l0aFVybChcIi9Ib2xkaW5nc0dyaWQvaHViXCIpXHJcbiAgICAgICAgLmJ1aWxkKCk7XHJcbiAgICBjYXRzQ2xpZW50ID0gbmV3IENhdHNDbGllbnQoKTtcclxuICAgICRjYXRNb2RhbCA9ICQoJyNjYXQtbW9kYWwnKTtcclxuICAgICRjYXRUaXRsZSA9ICQoJyNjYXQtbW9kYWwtdGl0bGUnKTtcclxuICAgICRjb25maXJtU2F2ZSA9ICQoJyNjb25maXJtLXNhdmUnKTtcclxuXHJcbiAgICAkZGVsZXRlTW9kYWwgPSAkKCcjZGVsZXRlLW1vZGFsJyk7XHJcbiAgICAkZGVsZXRlQ2F0TmFtZSA9ICQoJyNkZWxldGUtbW9kYWwtY2F0LW5hbWUnKTtcclxuICAgICRjb25maXJtRGVsZXRlID0gJCgnI2NvbmZpcm0tZGVsZXRlJyk7XHJcblxyXG4gICAgJGNhdElkID0gJCgnI2NhdC1pZCcpO1xyXG4gICAgJGNhdE5hbWUgPSAkKCcjY2F0LW5hbWUnKTtcclxuICAgICRjYXRCaXJ0aCA9ICQoJyNjYXQtYmlydGgnKTtcclxuICAgICRjYXRNb29kID0gJCgnI2NhdC1tb29kJyk7XHJcbiAgICAkY2F0SHVuZ3J5ID0gJCgnI2NhdC1odW5ncnknKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSB0aGlzLmdldENvbHVtbnMoKTtcclxuICAgICAgICB0aGlzLmdyaWRPcHRpb25zLmdldFJvd05vZGVJZCA9IChjYXQ6IENhdCkgPT4gY2F0LmlkIHx8IFwiXCI7XHJcbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucy5yb3dTZWxlY3Rpb24gPSAnc2luZ2xlJztcclxuICAgICAgICB0aGlzLmdyaWRPcHRpb25zLmVuYWJsZVNvcnRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuZ3JpZE9wdGlvbnMuZW5hYmxlQ2VsbENoYW5nZUZsYXNoID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmdyaWRPcHRpb25zLmVuYWJsZUNvbFJlc2l6ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucy5yb3dEYXRhID0gW107XHJcbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucy5vblNlbGVjdGlvbkNoYW5nZWQgPSAoZXZlbnQ6IFNlbGVjdGlvbkNoYW5nZWRFdmVudCkgPT4gdGhpcy5ncmlkU2VsZWN0aW9uQ2hhbmdlZChldmVudCk7XHJcbiAgICAgICAgY29uc3QgZUdyaWREaXY6IEhUTUxFbGVtZW50ID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXQtZ3JpZCcpO1xyXG4gICAgICAgIG5ldyBHcmlkKGVHcmlkRGl2LCB0aGlzLmdyaWRPcHRpb25zKTtcclxuXHJcbiAgICAgICAgdGhpcy5jYXRzQ2xpZW50LmdldCgoY2F0czogQ2F0W10gfCBudWxsKSA9PiB0aGlzLmxvYWRDYXRzKGNhdHMpKVxyXG5cclxuICAgICAgICAkKCcubW9kYWwtYWN0aW9uJykuY2xpY2soKGU6IEpRdWVyeS5DbGlja0V2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0ICR0YXJnZXQgPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgaWYgKCR0YXJnZXQuZGF0YSgnYWN0aW9uJykgJiYgJHRhcmdldC5kYXRhKCd0YXJnZXQnKSkge1xyXG4gICAgICAgICAgICAgICAgJCgkdGFyZ2V0LmRhdGEoJ3RhcmdldCcpKS5kYXRhKCdhY3Rpb24nLCAkdGFyZ2V0LmRhdGEoJ2FjdGlvbicpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLiRjYXRNb2RhbC5vbignc2hvdy5icy5tb2RhbCcsICgpID0+IHRoaXMuY2F0TW9kYWxTaG93bigpKTtcclxuICAgICAgICB0aGlzLiRkZWxldGVNb2RhbC5vbignc2hvdy5icy5tb2RhbCcsICgpID0+IHRoaXMuZGVsZXRlTW9kYWxTaG93bigpKTtcclxuICAgIH1cclxuICAgIGdyaWRTZWxlY3Rpb25DaGFuZ2VkKGV2ZW50OiBTZWxlY3Rpb25DaGFuZ2VkRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuZ2V0U2VsZWN0ZWRDYXQoKTtcclxuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgJCgnLnNlbGVjdGlvbi1yZXF1aXJlZCcpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICQoJy5zZWxlY3Rpb24tcmVxdWlyZWQnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNhdE1vZGFsU2hvd24oKSB7XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkID0gdGhpcy5nZXRTZWxlY3RlZENhdCgpIHx8IG5ldyBDYXQoKTtcclxuICAgICAgICB0aGlzLnNldE1vZGFsRnJvbUNhdChzZWxlY3RlZCk7XHJcbiAgICAgICAgdGhpcy4kY2F0VGl0bGUudGV4dChcIkFkZCBBIENhdFwiKTtcclxuICAgIH1cclxuICAgIGRlbGV0ZU1vZGFsU2hvd24oKSB7XHJcblxyXG4gICAgfVxyXG4gICAgbG9hZENhdHMoY2F0czogQ2F0W10gfCBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucy5hcGkhLnNldFJvd0RhdGEoY2F0cyB8fCBbXSk7XHJcbiAgICB9XHJcbiAgICBnZXRDb2x1bW5zKCk6IENvbERlZltdIHtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICB7IGhlYWRlck5hbWU6IFwiSWRcIiwgZmllbGQ6IFwiaWRcIiB9LFxyXG4gICAgICAgICAgICB7IGhlYWRlck5hbWU6IFwiTmFtZVwiLCBmaWVsZDogXCJuYW1lXCIgfSxcclxuICAgICAgICAgICAgeyBoZWFkZXJOYW1lOiBcIkJpcnRoXCIsIGZpZWxkOiBcImJpcnRoXCIgfSxcclxuICAgICAgICAgICAgeyBoZWFkZXJOYW1lOiBcIkh1bmdyeVwiLCBmaWVsZDogXCJodW5ncnlcIiB9LFxyXG4gICAgICAgICAgICB7IGhlYWRlck5hbWU6IFwiTW9vZFwiLCBmaWVsZDogXCJtb29kXCIgfVxyXG4gICAgICAgIF1cclxuICAgIH1cclxuICAgIGdldFNlbGVjdGVkQ2F0KCk6IENhdCB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmdyaWRPcHRpb25zLmFwaSEuZ2V0U2VsZWN0ZWROb2RlcygpO1xyXG4gICAgICAgIGlmIChzZWxlY3RlZCAmJiBzZWxlY3RlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkWzBdLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBnZXRDYXRGcm9tTW9kYWwoKTogQ2F0IHtcclxuICAgICAgICByZXR1cm4gbmV3IENhdCh7XHJcbiAgICAgICAgICAgIGlkOiB0aGlzLmdldElucHV0U3RyaW5nKHRoaXMuJGNhdElkKSxcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5nZXRJbnB1dFN0cmluZyh0aGlzLiRjYXROYW1lKSxcclxuICAgICAgICAgICAgYmlydGg6IHRoaXMuZ2V0SW5wdXREYXRlKHRoaXMuJGNhdEJpcnRoKSxcclxuICAgICAgICAgICAgaHVuZ3J5OiB0aGlzLmdldElucHV0Qm9vbGVhbih0aGlzLiRjYXRIdW5ncnkpLFxyXG4gICAgICAgICAgICBtb29kOiB0aGlzLmdldElucHV0TW9vZCh0aGlzLiRjYXRNb29kKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2V0TW9kYWxGcm9tQ2F0KGNhdDogQ2F0KSB7XHJcbiAgICAgICAgdGhpcy4kY2F0SWQudmFsKGNhdC5pZCB8fCBcIlwiKTtcclxuICAgICAgICB0aGlzLiRjYXROYW1lLnZhbChjYXQubmFtZSB8fCBcIlwiKTtcclxuICAgICAgICB0aGlzLiRjYXRCaXJ0aC52YWwobW9tZW50KGNhdC5iaXJ0aCkuZm9ybWF0KCkpO1xyXG4gICAgICAgIHRoaXMuJGNhdEh1bmdyeS5wcm9wKCdjaGVja2VkJywgY2F0Lmh1bmdyeSk7XHJcbiAgICAgICAgdGhpcy4kY2F0TW9kYWwudmFsKGNhdC5tb29kKTtcclxuICAgIH1cclxuICAgIGdldElucHV0U3RyaW5nKCRpbnB1dDogSlF1ZXJ5PEhUTUxFbGVtZW50Pik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gJGlucHV0LnZhbCgpO1xyXG4gICAgICAgIGlmICh2YWwgIT09IDAgJiYgIXZhbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gU3RyaW5nKHZhbCk7XHJcbiAgICB9XHJcbiAgICBnZXRJbnB1dERhdGUoJGlucHV0OiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogRGF0ZSB7XHJcbiAgICAgICAgY29uc3QgbSA9IG1vbWVudCgkaW5wdXQudmFsKCkpO1xyXG4gICAgICAgIGlmICghbS5pc1ZhbGlkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1vbWVudCgpLnRvRGF0ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtLnRvRGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldElucHV0Qm9vbGVhbigkaW5wdXQ6IEpRdWVyeTxIVE1MRWxlbWVudD4pOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gJGlucHV0LmlzKCc6Y2hlY2tlZCcpIHx8IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5wdXRNb29kKCRpbnB1dDogSlF1ZXJ5PEhUTUxFbGVtZW50Pik6IE1vb2Qge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9ICRpbnB1dC52YWwoKTtcclxuICAgICAgICBpZiAodmFsID09IE1vb2QuQW1iZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1vb2QuQW1iZXI7XHJcbiAgICAgICAgfSBlbHNlIGlmICh2YWwgPT0gTW9vZC5HcmVlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gTW9vZC5HcmVlbjtcclxuICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PSBNb29kLlJlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTW9vZC5SZWQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1vb2QuTm9uZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbm5ldyBTaXRlKCk7Il19